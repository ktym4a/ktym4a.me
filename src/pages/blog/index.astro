---
import Thumbnail from '@/assets/images/blog/thumbnail.png'
import Heading1 from '@/components/atoms/Heading1.astro'
import Link from '@/components/atoms/Link.astro'
import Tag from '@/components/atoms/Tag.astro'
import { BLOG_DESCRIPTION, SITE_NAME } from '@/constants/index'
import Layout from '@/layouts/Layout.astro'
import { COLORS } from '@/types/index'
import { formatPostDate, getPosts } from '@/utils/blog'
import { Image } from 'astro:assets'

const colors = [COLORS.GREEN, COLORS.PINK, COLORS.BLUE, COLORS.PEACH] as const

const allPosts = await getPosts().then((post) =>
    post
        .map((post, i) => {
            return {
                ...post,
                baseColor: colors[i % colors.length] as (typeof colors)[number]
            }
        })
        .reverse()
)

const baseColor = COLORS.PEACH
---

<Layout
    activeName='blog'
    title={`Blog - ${SITE_NAME}`}
    description={BLOG_DESCRIPTION}
    baseColor={baseColor}
>
    <section>
        <Heading1 baseColor={baseColor} text='Blog' id='Blog' />
    </section>
    <section
        id='Articles'
        class='grid grid-cols-[repeat(auto-fill,minmax(200px,_1fr))] gap-4'
    >
        {
            allPosts.map((post) => {
                return (
                    <article class='relative'>
                        <Link
                            href={`/blog/${post.slug}/`}
                            colors={{
                                text: post.baseColor.text as string,
                                childHoverBackground: post.baseColor
                                    .childHoverBackground as string,
                                childFocusBackground: post.baseColor
                                    .childFocusBackground as string,
                                childHoverOutline: post.baseColor
                                    .childHoverOutline as string,
                                childFocusOutline: post.baseColor
                                    .childFocusOutline as string
                            }}
                            class={''}
                            title={post.data.title}
                        >
                            <Tag text='Article' className='gap-2 h-full'>
                                <div class='space-y-3'>
                                    <div>
                                        {post.data.image ? (
                                            <img
                                                src={post.data.image}
                                                alt={post.data.title}
                                                class='h-40 w-full object-cover'
                                            />
                                        ) : (
                                            <Image
                                                src={Thumbnail}
                                                alt={post.data.title}
                                                class='h-40 w-full object-cover'
                                                title={post.data.title}
                                                width={337}
                                                height={160}
                                                quality={100}
                                                densities={[1.5, 2]}
                                            />
                                        )}
                                    </div>
                                    <div class=''>
                                        <p class='inline-flex items-center gap-1 text-sm text-ctp-text md:text-base'>
                                            <svg
                                                xmlns='http://www.w3.org/2000/svg'
                                                class='h-4 w-4 md:h-5 md:w-5'
                                                viewBox='0 0 24 24'
                                                stroke-width='2'
                                                stroke='currentColor'
                                                fill='none'
                                                stroke-linecap='round'
                                                stroke-linejoin='round'
                                            >
                                                <path
                                                    stroke='none'
                                                    d='M0 0h24v24H0z'
                                                    fill='none'
                                                />
                                                <path d='M4 5m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z' />
                                                <path d='M16 3v4' />
                                                <path d='M8 3v4' />
                                                <path d='M4 11h16' />
                                                <path d='M12 16m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0' />
                                            </svg>
                                            <time
                                                datetime={formatPostDate(
                                                    post.data.publishedDate
                                                )}
                                            >
                                                {formatPostDate(
                                                    post.data.publishedDate
                                                )}
                                            </time>
                                        </p>
                                        <h2 class='text-base font-bold md:text-lg'>
                                            {post.data.title}
                                        </h2>
                                    </div>
                                </div>
                            </Tag>
                        </Link>
                    </article>
                )
            })
        }
    </section>
</Layout>
